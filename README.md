<div align="center">

# Telegram Shop Bot

–õ—ë–≥–∫–∏–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è Telegram: FastAPI + aiogram, –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ YooKassa, –∞–¥–º–∏–Ω–∫–∞ –Ω–∞ Jinja2.

[![FastAPI](https://img.shields.io/badge/FastAPI-0.115+-009688?logo=fastapi&logoColor=white)](https://fastapi.tiangolo.com/)
[![Aiogram](https://img.shields.io/badge/aiogram-3.x-2CA5E0?logo=telegram&logoColor=white)](https://docs.aiogram.dev/)
[![PostgreSQL](https://img.shields.io/badge/Postgres-16-336791?logo=postgresql&logoColor=white)](https://www.postgresql.org/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

[–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏) ‚Ä¢ [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-docker) ‚Ä¢ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) ‚Ä¢ [–°–∫—Ä–∏–Ω—ã](#—Å–∫—Ä–∏–Ω—ã)

</div>

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–æ–¥–∞–∂–∞ —É—Å–ª—É–≥ –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –û—Ñ—Ñ–ª–∞–π–Ω –∑–∞–∫–∞–∑—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã)
- ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫
- ‚úÖ –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ YooKassa (–∫–∞—Ä—Ç–∞, –°–ë–ü)
- ‚úÖ –î–æ–Ω–∞—Ç—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ)
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞: —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±—ç–∫–∞–ø/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ Digital-—Ç–æ–≤–∞—Ä—ã: —Ç—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
    - **file** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
    - **github** - –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
    - **codes** - –≤—ã–¥–∞—á–∞ –ø–æ–∑–∏—Ü–∏–π –∏–∑ TXT (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–¥)
- ‚úÖ Telegram-–±–æ—Ç: –∫–∞—Ç–∞–ª–æ–≥, –∫–∞—Ä—Ç–æ—á–∫–∏, –ø–æ–∫—É–ø–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –°–∫—Ä–∏–Ω—ã

<p align="center">
  <img src="docs/orders.png" alt="–ó–∞–∫–∞–∑—ã" width="480" />
</p>
<p align="center">
  <img src="docs/admin.png" alt="–ê–¥–º–∏–Ω–∫–∞" width="320" />
  <img src="docs/new-item.png" alt="–ù–æ–≤—ã–π –∑–∞–∫–∞–∑" width="320" />
</p>
<p align="center">
  <img src="docs/bot.png" alt="–ë–æ—Ç" width="240" />
</p>

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

### üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
curl -o launcher.sh https://raw.githubusercontent.com/gopnikgame/telegram-shop-bot/main/launcher.sh
chmod +x launcher.sh
sudo ./launcher.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (git, docker, nano)
- ‚úÖ –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ `/opt/telegram-shop-bot`
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `.env` –∏ `texts.yml`

### üõ†Ô∏è –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1) –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ `.env`:

```bash
cp .env.example .env
nano .env  # –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
- `YK_SHOP_ID` - ID –º–∞–≥–∞–∑–∏–Ω–∞ YooKassa
- `YK_SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á YooKassa

2) –ó–∞–ø—É—Å–∫:

```bash
docker compose up --build -d
```

3) –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ–¥–∏–Ω —Ä–∞–∑):

```bash
docker compose exec api alembic upgrade head
```

4) –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ:

- API: http://localhost:8000
- Health: http://localhost:8000/health/
- Admin: http://localhost:8000/admin/
- Webhook: POST http://localhost:8000/telegram/webhook

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä:

```bash
cd /opt/telegram-shop-bot
./manage_bot.sh
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**
- üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (.env, texts.yml)
- üê≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î (–º–∏–≥—Ä–∞—Ü–∏–∏, –±—ç–∫–∞–ø—ã)
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- üßπ –û—á–∏—Å—Ç–∫–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
./scripts/quick_start.sh    # –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
./scripts/quick_stop.sh     # –ë—ã—Å—Ç—Ä–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
./scripts/logs.sh           # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./scripts/backup_db.sh      # –ë—ç–∫–∞–ø –ë–î
./scripts/update.sh         # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
alembic upgrade head
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```ini
# Telegram
BOT_TOKEN=your_bot_token

# YooKassa
YK_SHOP_ID=your_shop_id
YK_SECRET_KEY=your_secret_key
YK_RETURN_URL=http://localhost:8000/thanks

# Database (–¥–ª—è Docker —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
DATABASE_URL=postgresql+asyncpg://shopbot:shopbot@localhost:5432/shopbot
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- `YK_WEBHOOK_USER`, `YK_WEBHOOK_PASSWORD` ‚Äî Basic –∑–∞—â–∏—Ç–∞ –≤–µ–±—Ö—É–∫–∞ YooKassa
- `BASE_URL`, `PORT` ‚Äî –±–∞–∑–æ–≤—ã–π URL API –∏ –ø–æ—Ä—Ç
- `ADMIN_USERNAME`, `ADMIN_PASSWORD` ‚Äî –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∫–∏
- `ADMIN_CHAT_ID` ‚Äî –∫—É–¥–∞ —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `ADMIN_TG_USERNAME` ‚Äî username –¥–ª—è –∫–Ω–æ–ø–∫–∏ ¬´–°–≤—è–∑–∞—Ç—å—Å—è¬ª
- `SHOW_CONTACT_BUTTON`, `SHOW_DONATE_BUTTON` ‚Äî —Ñ–ª–∞–≥–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫
- `EMAIL_DOMAIN` ‚Äî –¥–æ–º–µ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ email –ø–æ tg_id
- `UPLOAD_DIR` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –∑–∞–≥—Ä—É–∑–æ–∫ (–º–∞–ø–∏—Ç—Å—è –≤ Docker –≤ volume)
- `WEBHOOK_URL`, `WEBHOOK_SECRET` ‚Äî –≤–µ–±—Ö—É–∫ Telegram
- `DONATE_AMOUNTS` ‚Äî —Å—É–º–º—ã –¥–æ–Ω–∞—Ç–æ–≤, —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 100,200,500)

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [.env.example](.env.example)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è YooKassa

- **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞:** `POST /orders/` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç—ë–∂, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `payment_url`
- **–í–µ–±—Ö—É–∫:** `POST /payments/yookassa/webhook` ‚Äî –Ω–∞ `payment.succeeded`:
  - –ü–æ–º–µ—á–∞–µ—Ç –∑–∞–∫–∞–∑ –∫–∞–∫ `paid`
  - –°–æ–∑–¥–∞—ë—Ç –ø–æ–∫—É–ø–∫—É
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É
  - –î–ª—è `delivery_type=codes`: —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
telegram-shop-bot/
‚îú‚îÄ‚îÄ app/                    # API (—Ä–æ—É—Ç—ã, –º–æ–¥–µ–ª–∏, —Å—Ö–µ–º—ã, —Å–µ—Ä–≤–∏—Å—ã, –∞–¥–º–∏–Ω–∫–∞)
‚îú‚îÄ‚îÄ bot/                    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ aiogram + –≤–µ–±—Ö—É–∫-—Ä–æ—É—Ç
‚îú‚îÄ‚îÄ alembic/                # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ scripts/                # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ logs.sh             # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ backup_db.sh        # –ë—ç–∫–∞–ø –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ update.sh           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ uploads/                # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã/–±—ç–∫–∞–ø—ã (volume –≤ Docker)
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ DEPLOYMENT.md       # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
‚îú‚îÄ‚îÄ launcher.sh             # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
‚îú‚îÄ‚îÄ manage_bot.sh           # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
‚îî‚îÄ‚îÄ docker-compose.yml      # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## –ê–¥–º–∏–Ω–∫–∞ ‚Äî —Ä–∞–±–æ—Ç–∞ —Å TXT –∫–æ–¥–∞–º–∏

- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ digital‚Äë—Ç–æ–≤–∞—Ä–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ `codes`
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ TXT —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É
- –í —Å–ø–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ¬´–û—Å—Ç–∞—Ç–æ–∫¬ª
- –î–ª—è –¥–æ–≥—Ä—É–∑–∫–∏ –∫–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É ¬´‚ûïTXT¬ª

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- –õ–æ–∫–∞–ª—å–Ω–æ —É–¥–æ–±–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ –≤ polling-—Ä–µ–∂–∏–º–µ: `python -m bot.run_bot`
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±—Ö—É–∫ (`WEBHOOK_URL`) –∏ `docker compose`

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
./scripts/update.sh
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä: `./scripts/manage_bot.sh` ‚Üí –ø—É–Ω–∫—Ç 16

### –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
./scripts/backup_db.sh
```

–ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/opt/telegram-shop-bot/backups/`

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
./scripts/logs.sh [all|api|db|errors|follow]
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl http://localhost:8000/health/
docker compose ps
```

## üÜò Troubleshooting

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md#-troubleshooting)

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- Docker –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí `sudo systemctl start docker`
- –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç ‚Üí –∏–∑–º–µ–Ω–∏—Ç–µ `PORT` –≤ `.env`
- –ë–î –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `docker compose logs db`
- –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `BOT_TOKEN` –≤ `.env`

## –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](LICENSE)

---

<div align="center">

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/gopnikgame/telegram-shop-bot

**Upstream:** https://github.com/TrackLine/telegram-shop-bot

Made with ‚ù§Ô∏è for Telegram Shop Bot

Documentation prepared using Claude...

</div>
